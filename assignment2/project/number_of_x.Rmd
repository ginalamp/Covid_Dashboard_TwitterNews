---
title: "Number of x"
author: "Gina"
output: html_notebook
---
# TODO
* label each column with the number of days that spans each variable (for example state that the number of retweets for SABC occured over x days)
* perhaps do histogram combining charts?
* label each column with number

<!----------------------------------------------------------------------------------------------------------------------------------------------------->
<!-- Setup -->
<!----------------------------------------------------------------------------------------------------------------------------------------------------->

<!-- Set colours according to Stellenbosch Branding manual-->
<!-- http://stbweb01.stb.sun.ac.za/centenarybrandtoolkit/SU_Brand_Manual_2019.pdf -->
```{r set colours}
dailymav_colour <- "#FF8F1C" # Daily Maveric - arts_orange
capetalk_colour <- "#9e2629" # Cape Talk - law_winered
sabc_colour <- "#84329B" # SABC News - theology_purple
news24_colour <- "#326295" # News24 - education_darkblue
ewn_colour <- "#509e2f" # EWN - agri_green

# other colours to use
med_bluegreen <- "#006163"
military_salmon <- "#e56a54"
science_red <- "#cb333b"
ems_lightblue <- "#2dccd3"
maroon <- "#60223b"
mustard <- "#F1B434"
darkgrey <- "#333333"
lightgrey <- "#8c979a"
black <- "#000000"
engineering_yellow <- "#eaaa00"
```

```{r custom themes}
custom_column_basic_theme <- function () { 
    theme_minimal(base_size=12, base_family="Avenir") +
        theme(
            panel.background  = element_blank(),
            panel.grid.minor = element_blank(),
            legend.position="none", # no legend
            plot.title = element_text(size = 10, hjust = 0),
            plot.caption = element_text(size = 8, hjust = 0)
        )
}
```

```{r import libraries}
library(tidyverse)
```

```{r extract relevant data from read in csv}
extract_relevant_data <- function(df) {
  return(df %>% select(status_id, screen_name, created_at, statuses_count, is_retweet, favorite_count, retweet_count, followers_count, friends_count, text))
}
```

```{r read data}
CapeTalk_tweets <- extract_relevant_data(read.csv("data/CapeTalk_tweets.csv"))
DailyMav_tweets <- extract_relevant_data(read.csv("data/DailyMav_tweets.csv"))
EWN_tweets <- extract_relevant_data(read.csv("data/EWN_tweets.csv"))
News24_tweets <- extract_relevant_data(read.csv("data/News24_tweets.csv"))
SABCNews_tweets <- extract_relevant_data(read.csv("data/SABCNews_tweets.csv"))

media_outlet_list <- list(CapeTalk_tweets, DailyMav_tweets, EWN_tweets, News24_tweets, SABCNews_tweets)
head(media_outlet_list[1])
```
<!----------------------------------------------------------------------------------------------------------------------------------------------------->
<!-- Data Wrangling -->
<!----------------------------------------------------------------------------------------------------------------------------------------------------->

```{r get number of followers, friends, tweets, and retweets per media outlet}
# get name, follower, friend, and tweet values
names <- unlist(lapply(media_outlet_list, function(df) {return(df$screen_name[1])}))
followers_count <- unlist(lapply(media_outlet_list, function(df) {return(df$followers_count[1])}))
friends_count <- unlist(lapply(media_outlet_list, function(df) {return(df$friends_count[1])}))
tweets_count <- unlist(lapply(media_outlet_list, function(df) {return(df$statuses_count[1])}))
# calculate user retweet sum
user_retweet_sum <- unlist(lapply(media_outlet_list, function(df) {return(sum(df$retweet_count))}))
# calculate media outlet's number of retweets (is_retweet == TRUE)
outlet_retweet_count <- unlist(lapply(media_outlet_list, function(df) {return(NROW(df$status_id[df$is_retweet]))}))

# join values into a dataframe
number_of_x <- data.frame(name=names, 
                          followers_count=followers_count, 
                          friends_count=friends_count, 
                          tweets_count=tweets_count, 
                          user_retweet_sum=user_retweet_sum,
                          outlet_retweet_count=outlet_retweet_count)
head(number_of_x)
```
```{r in progress - try to combine favourited and retweet functions}
b <- function(CapeTalk_tweets, column_name){
    eval(substitute(column_name), CapeTalk_tweets)
}
# CapeTalk_tweets
b(CapeTalk_tweets, favorite_count)
```

```{r get top x tweets per media outlet}
get_top_retweets <- function(df) {
  x <- 5
  text <- df %>%
    arrange(desc(retweet_count)) %>% 
    slice(1:x) %>% 
    select(screen_name, retweet_count, text)
  return(text)
}
```

```{r get top x favourited tweets per media outlet}
get_top_favorited_tweets <- function(df) {
  x <- 5
  text <- df %>%
    arrange(desc(favorite_count)) %>% 
    slice(1:x) %>% 
    select(screen_name, favorite_count, text)
  return(text)
}
```

```{r top 5 user retweeted tweets per media outlet}
# TODO need to plot nicely (as table?)
top_retweets <- lapply(media_outlet_list, get_top_retweets)
top_retweets
```

```{r top 5 favourited tweets per media outlet}
# TODO need to plot nicely (as table?)
top_favourited <- lapply(media_outlet_list, get_top_favorited_tweets)
top_favourited
```

```{r}
# select tweet IDs that are retweets
CapeTalk_tweets$status_id[(CapeTalk_tweets$is_retweet)]
```



<!----------------------------------------------------------------------------------------------------------------------------------------------------->
<!-- Data Visualisation -->
<!----------------------------------------------------------------------------------------------------------------------------------------------------->

```{r plot followers per media outlet}
ggplot(number_of_x, aes(name, followers_count, fill=name)) +
  geom_col() +
  labs(title = "Number of followers per media outlet",
       x=NULL,
       y=NULL) +
  scale_y_continuous(label=comma) +
  scale_fill_manual(values = c(capetalk_colour, dailymav_colour, ewn_colour, news24_colour, sabc_colour)) +
  custom_column_basic_theme()
```
```{r plot friends per media outlet}
ggplot(number_of_x, aes(name, friends_count, fill=name)) +
  geom_col() +
  labs(title = "Number of friends per media outlet",
       x=NULL,
       y=NULL) +
  scale_y_continuous(label=comma) +
  scale_fill_manual(values = c(capetalk_colour, dailymav_colour, ewn_colour, news24_colour, sabc_colour)) +
  custom_column_basic_theme()
```
```{r plot tweets per media outlet}
ggplot(number_of_x, aes(name, tweets_count, fill=name)) +
  geom_col() +
  labs(title = "Number of tweets per media outlet",
       x=NULL,
       y=NULL) +
  scale_y_continuous(label=comma) +
  scale_fill_manual(values = c(capetalk_colour, dailymav_colour, ewn_colour, news24_colour, sabc_colour)) +
  custom_column_basic_theme()
```
```{r plot retweets of users per media outlet}
ggplot(number_of_x, aes(name, user_retweet_sum, fill=name)) +
  geom_col() +
  labs(title = "Number of user retweets per media outlet",
       x=NULL,
       y=NULL) +
  scale_y_continuous(label=comma) +
  scale_fill_manual(values = c(capetalk_colour, dailymav_colour, ewn_colour, news24_colour, sabc_colour)) +
  custom_column_basic_theme()
```
```{r plot retweets of outlets per media outlet}
ggplot(number_of_x, aes(name, outlet_retweet_count, fill=name)) +
  geom_col() +
  labs(title = "Number of outlet retweets per media outlet",
       x=NULL,
       y=NULL) +
  scale_y_continuous(label=comma) +
  scale_fill_manual(values = c(capetalk_colour, dailymav_colour, ewn_colour, news24_colour, sabc_colour)) +
  custom_column_basic_theme()
```
