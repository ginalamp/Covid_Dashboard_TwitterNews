---
title: "Doubling Rate: Deaths and Confirmed Cases"
output: html_notebook
---

# Theory
Calculating the doubling rate based on the prior 7 days:

$t_2 - t_1 = 7$

$T_d = (t_2 - t_2)\frac{ln(2)}{ln(\frac{q2}{q1})}$

Example of Surat city Table 1 shows data wise cumulative COVID19 cas-es  reported  in  Surat  city.3  According  to  Formula2using  the  data  of  COVID19  Doubling  rate/time  calculated  for  24th   March   2020   considering   17thMarch 2020 is day 1 ( t1 = 1), 24th March 2020 is Day 8  (t2 =  8)  ,  q1 is  number  of  cases  on  day  1  (17thMarch 2020 ) = 1 ,q2 number of cases on day 8 (24thMarch  2020)  =5  ,  ln(2)  is  natural  logarithmic  value  of 2 . 

source: [Doubling Time and its Interpretation for COVID 19 Cases](http://njcmindia.org/uploads/11-3_141-143.pdf)


## Method
1. Get confirmed/death data
2. Calculate doubling rate for each entry on a 7-day basis (creating a column with doubling rates)
3. plot

# Importing
```{r}
library(tidyverse)
library(lubridate) # dates
library(ggplot2)
library(EcoHydRology)
```

```{r}
if ( require(EcoHydRology) ) {
  detach("package:dplyr", unload = TRUE)
  detach("package:EcoHydRology", unload = TRUE)
  require(dplyr)
}
```


# Reading data
```{r}
# provincial_total_confirmed <- read.csv("data/covid19za_provincial_cumulative_timeline_confirmed.csv")
provincial_total_confirmed <- read.csv("data/owid-covid-data_SouthAfricaExtracted_big.csv")
head(provincial_total_confirmed)
```
# Confirmed cases

```{r}
  # Get total confirmed cases per date
  confirmed <- provincial_total_confirmed %>% 
  filter(!is.na(total_cases)) %>% 
  select(date, total_cases) %>% 
  mutate(date = as.Date(date))
  head(confirmed)
```

## Calculate doubling rate
```{r}
# calculate 7-day doubling rate
calculate_doubling_rate <- function(num_days, q1, q2) {
  doubling_rate <- num_days*(log(2)/(log(q2/q1)))
  return(doubling_rate)
}
```

```{r}
  # # Get total confirmed cases per date
  # confirmed <- provincial_total_confirmed %>% 
  # select(date, total) %>% 
  # mutate(date = dmy(date)) 
  # head(confirmed)
  
  # create subset of confirmed to apply doubling rate function to
  num_days <- 100
  confirmed_after_num_days <- confirmed %>% tail(-num_days)
  
  # add num_days 0s at end
  date <- rep(c(Sys.Date()),num_days)
  total_cases <- rep(c(0),num_days)
  data_temp<- data.frame(date, total_cases)
  data_temp <- as.data.frame(data_temp)
  confirmed_after_num_days <- rbind(confirmed_after_num_days, data_temp, make.row.names=FALSE)
  tail(confirmed_after_num_days)
  
  # confirmed$doubling_rate <- with(confirmed, calculate_doubling_rate(num_days, confirmed$total, confirmed_after_num_days$total))
  # confirmed  <- confirmed %>% head(-num_days)
  # head(confirmed)
```
```{r}
  confirmed$doubling_rate <- with(confirmed, calculate_doubling_rate(num_days, confirmed$total_cases, confirmed_after_num_days$total_cases))
  confirmed  <- confirmed %>% head(-num_days)
  head(confirmed)
```


```{r}
ggplot(confirmed, aes(date, doubling_rate)) + 
  geom_line() +
  labs(title= "Confirmed doubling rate",
       caption = "Updated: June 2021",
       x = NULL,
       y = NULL) +
  theme_minimal()
```





