---
title: "R Notebook"
output: html_notebook
---

```{r Setup}
library(tidyverse)
library(lubridate)
```

```{r Data: Confirmed Cases}
data <- read.csv("data/covid19za_provincial_cumulative_timeline_confirmed.csv")
head(data)
```
```{r Tidy data}
cases <- data %>% pivot_longer(c('EC', 'FS', 'GP', 'KZN', 'LP', 'MP', 'NC', 'NW', 'WC', 'UNKNOWN'), names_to = "province", values_to = "cases")
cases <- cases %>% 
  select(date, province, cases, total)  %>% 
  filter(province != 'UNKNOWN')
cases <- cases %>% mutate(date = dmy(date))

head(cases)
```


```{r Plot}
ggplot(cases, aes(date, cases)) + 
  geom_smooth(color = "blue") + 
  scale_y_continuous(breaks = seq(0, 1000000, by = 100000), limits = c(0, 1000000), labels = NULL) +
  scale_x_date(labels = NULL) +
  facet_wrap(~ province, nrow = 2) +
  theme_minimal() +
  labs(title= "Confirmed Cases by Province",
       x = NULL,
       y = NULL)

```
```{r}
library(RcppRoll)

cases <- cases %>%
  group_by(province) %>%
  mutate(daily_cases=cases-lag(cases,default=0)) %>%
  mutate(rolling_avg = roll_mean(daily_cases, n=7, fill = NA, align = "right"))

cases_last_8_mths <- cases %>%
  filter(date >= ymd("2020-11-12"))

ggplot(cases_last_8_mths, aes(date, rolling_avg)) + 
  geom_point(color = "blue") + 
  scale_y_continuous(labels = NULL) +
  scale_x_date(labels = NULL) +
  facet_wrap(~ province, nrow = 2) +
  theme_minimal() +
  labs(title= "Daily Case Trends per Province",
       x = NULL,
       y = NULL)
```

